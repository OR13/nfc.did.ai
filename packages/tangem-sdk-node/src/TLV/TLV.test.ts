import {
  parseRequest,
  parseResponse,
  // tlvToObject
} from './TLV';

const readCardRequest =
  '00F2000022102091B4D142823F7D20C5F08DF69122DE43F35F057A988D9619F6D3138485C9A203';
const cardReadResponse =
  '0108bb03000000000004200754414e47454d00020102800a322e3330642053444b00034104892f342438b951c9c85a487c65d06cc3f252d5cd6dc50ef2635dbfec110ff9af26b6d8f66f5d0ab04756257eab9dbd1f54bbbd7e4d5851dd326b977c4a5894910a04040e7e310c678102ffff8a0100820407e40511830b54414e47454d2053444b0084010aa000a100a202000086409a433a0b0d75f506842e154287aad0711ff37aebe8f3919af14c4938ef0d3399f14c97a1be61f3a2f91ce380a12fc644d81243e05870e769a99a421a800e034d3041045f16bd1d2eafe463e62a335a09e6b2bbcbd04452526885cb679fc4d27af1bd22f553c7deefb54fd3d4f361d14e6dc3f11b7d4ea183250a60720ebdf9e110cd26050a736563703235366b31000804000f423f070100604104808b1274377fc81e63d23ffa4117f6b966abd80f726ccee5df9282e6f006aeff2cff96de64049ed5f8ab55faeaa423bd24495a47c400fe8feffda21b31a76e856204000f423f6304000000000f01009000';

// const signCardRequest =
//   '00FB0000000139102091B4D142823F7D20C5F08DF69122DE43F35F057A988D9619F6D3138485C9A2030108BB0300000000000411202AC9A6746ACA543AF8DFF39894CFE8173AFBA21EB01C6FAE33D52947222855EF52402705649CD255A07EFDF3528B4D63FB60CE18C85E403F66D3BA7F1F63D476A3E34225F6F5659785180C313895EEFEB1B4340E897210C7F770BE2A1C7142435B9E06077368612D353132';

const cardSignReponse =
  '0108bb030000000000045040aed9605f8560c31dbf29c55369b6c89ce5ab981e7d2135c8f9c61f568298dee7f57758fd3e5a5f114fe9dbe7e3ee90a4f3cbe85aa0bcf395d103bdc67f8580b3614071dcccedd9e903593b0cc3f8306374b59a25717b0840007a300677c310ca9dbeddd5f74426961c146689c3622afcf473f3a6b0d739df36bab9fe5ef92631380d6204000f423d6304000000029000';

describe('TLV', () => {
  it('read', async () => {
    const parsedRequest = await parseRequest(
      Buffer.from(readCardRequest, 'hex')
    );
    expect(parsedRequest).toEqual({
      CLA: '00',
      INS: 'F2',
      P1: '00',
      P2: '00',
      Lc: '22',
      Tag: '10',
      Length: '20',
      Value: '91B4D142823F7D20C5F08DF69122DE43F35F057A988D9619F6D3138485C9A203',
    });

    const parsedResponse = await parseResponse(
      Buffer.from(cardReadResponse, 'hex')
    );
    expect(parsedResponse).toEqual({
      SW: '9000',
      CID: 'BB03000000000004',
      Manufacturer_ID: '54414E47454D00',
      Status: '02',
      Firmware: '322E3330642053444B00',
      CARD_PUBLIC_KEY:
        '04892F342438B951C9C85A487C65D06CC3F252D5CD6DC50EF2635DBFEC110FF9AF26B6D8F66F5D0AB04756257EAB9DBD1F54BBBD7E4D5851DD326B977C4A589491',
      Settings_Mask: '040E7E31',
      Card_Data:
        '8102FFFF8A0100820407E40511830B54414E47454D2053444B0084010AA000A100A202000086409A433A0B0D75F506842E154287AAD0711FF37AEBE8F3919AF14C4938EF0D3399F14C97A1BE61F3A2F91CE380A12FC644D81243E05870E769A99A421A800E034D',
      ISSUER_PUBLIC_KEY:
        '045F16BD1D2EAFE463E62A335A09E6B2BBCBD04452526885CB679FC4D27AF1BD22F553C7DEEFB54FD3D4F361D14E6DC3F11B7D4EA183250A60720EBDF9E110CD26',
      Curve_ID: '736563703235366B3100',
      Max_Signatures: '000F423F',
      Signing_Method: '00',
      WALLET_PUBLIC_KEY:
        '04808B1274377FC81E63D23FFA4117F6B966ABD80F726CCEE5DF9282E6F006AEFF2CFF96DE64049ED5F8AB55FAEAA423BD24495A47C400FE8FEFFDA21B31A76E85',
      Wallet_Remaining_Signatures: '000F423F',
      Wallet_Signed_Hashes: '00000000',
      Health: '00',
    });
  });

  it.only('sign', async () => {
    // const parsedRequest = await parseRequest(
    //   Buffer.from(signCardRequest, 'hex')
    // );
    // expect(parsedRequest).toEqual({
    //   CLA: '00',
    //   INS: 'FB',
    //   P1: '00',
    //   P2: '00',
    //   Lc: '00',
    //   Tag: '01',
    //   Length: '39',
    //   Value:
    //     '102091B4D142823F7D20C5F08DF69122DE43F35F057A988D9619F6D3138485C9A2030108BB0300000000000411202AC9A6746ACA543AF8DFF39894CFE8173AFBA21EB01C6FAE33D52947222855EF52402705649CD255A07EFDF3528B4D63FB60CE18C85E403F66D3BA7F1F63D476A3E34225F6F5659785180C313895EEFEB1B4340E897210C7F770BE2A1C7142435B9E06077368612D353132',
    //   Parsed_Value: {
    //     PIN1:
    //       '91B4D142823F7D20C5F08DF69122DE43F35F057A988D9619F6D3138485C9A203',
    //     CID: 'BB03000000000004',
    //     PIN2:
    //       '2AC9A6746ACA543AF8DFF39894CFE8173AFBA21EB01C6FAE33D52947222855EF',
    //     Transaction_Raw:
    //       '2705649CD255A07EFDF3528B4D63FB60CE18C85E403F66D3BA7F1F63D476A3E34225F6F5659785180C313895EEFEB1B4340E897210C7F770BE2A1C7142435B9E',
    //     Hash_Name: 'sha-512',
    //   },
    // });

    await parseResponse(Buffer.from(cardSignReponse, 'hex'));
    // console.log(parsedResponse);
  });
});
