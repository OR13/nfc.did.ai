01 08 bb03000000000004
50 40 aed9605f8560c31dbf29c55369b6c89ce5ab981e7d2135c8f9c61f568298dee7f57758fd3e5a5f114fe9dbe7e3ee90a4f3cbe85aa0bcf395d103bdc67f8580b3

61 40 71dcccedd9e903593b0cc3f8306374b59a25717b0840007a300677c310ca9dbeddd5f74426961c146689c3622afcf473f3a6b0d739df36bab9fe5ef92631380d

62 04
000f423d
63 04
00000002

9000

-- 0.112 s: Sign
TAG_PIN[0x10:32]: 91B4D142823F7D20C5F08DF69122DE43F35F057A988D9619F6D3138485C9A203
TAG_CardID[0x01:8]: BB03000000000004
TAG_PIN2[0x11:32]: 2AC9A6746ACA543AF8DFF39894CFE8173AFBA21EB01C6FAE33D52947222855EF
TAG_TrOut_HashSize[0x51:1]: 40
TAG_TrOut_Hash[0x50:640]: B6CB700ED6E0EAF4B179B590349AFC8E96804164B5EFC36AF3EE8A35F4B863178E9A089BDD10453330A56BA77B7D83419DB048E294BE23373208EFF448E6C2DA222B2F64C285E66996769B5A03EF863CFD3B63DDB0727788291695E8FB84572E4BFE5A80674A41FD72EEB48592C9C79F44AE992C76ED1B0D55A670A83FC99EC6A8498EDC4CF1121623C409A8AAE3A16BB4441DE89F4CAA7BDE903B6C4057967E552B31C7EFB45ED96AA9144931A1DF3C7F53685F297A6FA019582C8B42C0D2856ADC595F08C28F75652C6C6F258E52152C39B1C56DE9CAFB1A38A096B80540C266292156A37AB134DA14F3B0F4BBA5433675BF39F947BB5418804830769896AEC6619FC744156858FD135D5CE392E96A1FF5384A11FD8977E35762ACB4224860A5A2F53D8DC4FA8FBCFF1AF990256617482CAFF472C6EF745FB0DB52D77411D0CF93DEC95DA6B9270337395EE4496BF217DF34C3A74D3F0B8624B90FC6EFF8669FFC88F647D40A7CB30D2035A72F7E44F412D9E463A49FB85931F2054C7D3F907FB9BA8168A7644E9FE589A65957C4A1E701B86F2ACB0602EE3A5CFA173628F4C3EC8BAD4F5A9639265345C0722A6161F581EB4E02992DA737EE0C6F93183DBBB4EB940D11A2635C5B25C7899C7D5E78818A4E289DA075F5DF61F7AC5E01FD81423CC19CEC4B2185290950EC7B7F6485BFEC606A5B8D017C02F48118B4FFE11C7AD277B4831CB44CF87BE9AB627C5CACCEECE9EDB06B5D7C3200099E54F1634578015445019E61A4EB895614059C97FF48F4004EA83DA985FB0F823D2143F55302516439EBDAF3C450734E326155DB8D6DD2E436373987B2EE717993C8C260F0C2FC14203CC2632B10EB90F73DDE1357FCDC47DC3107D2DE5C46A9BCD53FCED2

--> 0.114 s: [732 bytes]
00FB0000 0002D5 1020 // intro
91B4D142823F7D20C5F08DF69122DE43F35F057A988D9619F6D3138485C9A203 // pin

0108 // TAG_CardID[0x01:8]
BB03000000000004 // card id
1120 // TAG_PIN2[0x11:32]
2AC9A6746ACA543AF8DFF39894CFE8173AFBA21EB01C6FAE33D52947222855EF

5101 // TAG_TrOut_HashSize[0x51:1]
40
50 FF 0280 // TAG_TrOut_Hash[0x50:640]:
//hash
B6CB700ED6E0EAF4B179B590349AFC8E96804164B5EFC36AF3EE8A35F4B86317
8E9A089BDD10453330A56BA77B7D83419DB048E294BE23373208EFF448E6C2DA
222B2F64C285E66996769B5A03EF863CFD3B63DDB0727788291695E8FB84572E
4BFE5A80674A41FD72EEB48592C9C79F44AE992C76ED1B0D55A670A83FC99EC6
A8498EDC4CF1121623C409A8AAE3A16BB4441DE89F4CAA7BDE903B6C4057967E
552B31C7EFB45ED96AA9144931A1DF3C7F53685F297A6FA019582C8B42C0D285
6ADC595F08C28F75652C6C6F258E52152C39B1C56DE9CAFB1A38A096B80540C2
66292156A37AB134DA14F3B0F4BBA5433675BF39F947BB5418804830769896AE
C6619FC744156858FD135D5CE392E96A1FF5384A11FD8977E35762ACB4224860
A5A2F53D8DC4FA8FBCFF1AF990256617482CAFF472C6EF745FB0DB52D77411D0
CF93DEC95DA6B9270337395EE4496BF217DF34C3A74D3F0B8624B90FC6EFF866
9FFC88F647D40A7CB30D2035A72F7E44F412D9E463A49FB85931F2054C7D3F90
7FB9BA8168A7644E9FE589A65957C4A1E701B86F2ACB0602EE3A5CFA173628F4
C3EC8BAD4F5A9639265345C0722A6161F581EB4E02992DA737EE0C6F93183DBB .
B4EB940D11A2635C5B25C7899C7D5E78818A4E289DA075F5DF61F7AC5E01FD81
423CC19CEC4B2185290950EC7B7F6485BFEC606A5B8D017C02F48118B4FFE11C
7AD277B4831CB44CF87BE9AB627C5CACCEECE9EDB06B5D7C3200099E54F16345
78015445019E61A4EB895614059C97FF48F4004EA83DA985FB0F823D2143F553
02516439EBDAF3C450734E326155DB8D6DD2E436373987B2EE717993C8C260F0
C2FC14203CC2632B10EB90F73DDE1357FCDC47DC3107D2DE5C46A9BCD53FCED2

<-- response....
0108bb0300000000000450ff0280b6cb700ed6e0eaf4b179b590349afc8e96804164b5efc36af3ee8a35f4b863178e9a089bdd10453330a56ba77b7d83419db048e294be23373208eff448e6c2da222b2f64c285e66996769b5a03ef863cfd3b63ddb0727788291695e8fb84572e4bfe5a80674a41fd72eeb48592c9c79f44ae992c76ed1b0d55a670a83fc99ec6a8498edc4cf1121623c409a8aae3a16bb4441de89f4caa7bde903b6c4057967e552b31c7efb45ed96aa9144931a1df3c7f53685f297a6fa019582c8b42c0d2856adc595f08c28f75652c6c6f258e52152c39b1c56de9cafb1a38a096b80540c266292156a37ab134da14f3b0f4bba5433675bf39f947bb5418804830769896aec6619fc744156858fd135d5ce392e96a1ff5384a11fd8977e35762acb4224860a5a2f53d8dc4fa8fbcff1af990256617482caff472c6ef745fb0db52d77411d0cf93dec95da6b9270337395ee4496bf217df34c3a74d3f0b8624b90fc6eff8669ffc88f647d40a7cb30d2035a72f7e44f412d9e463a49fb85931f2054c7d3f907fb9ba8168a7644e9fe589a65957c4a1e701b86f2acb0602ee3a5cfa173628f4c3ec8bad4f5a9639265345c0722a6161f581eb4e02992da737ee0c6f93183dbbb4eb940d11a2635c5b25c7899c7d5e78818a4e289da075f5df61f7ac5e01fd81423cc19cec4b2185290950ec7b7f6485bfec606a5b8d017c02f48118b4ffe11c7ad277b4831cb44cf87be9ab627c5cacceece9edb06b5d7c3200099e54f1634578015445019e61a4eb895614059c97ff48f4004ea83da985fb0f823d2143f55302516439ebdaf3c450734e326155db8d6dd2e436373987b2ee717993c8c260f0c2fc14203cc2632b10eb90f73dde1357fcdc47dc3107d2de5c46a9bcd53fced261ff0280ca6e52087935856512812dc55f621c49d1c082d312afab0da0be940aec0f8f7ddf55ed35bd3abb3064864e508d4b64c3ab180b3e330eaf0da091d6f014e3ea0be0a9019a93e979bbadd6f173c9686e6bc36ec0f77f4ed4a65d124bc325c95b9e794294785d28e22929e83f44b334314bfc639e931f4fe43229b61baa8c372d050f9d222324d93f1736fe8e858f567610ae8854f0f38d8b2f478c7e7bb81fc9987793d13dee6a7e02aa3a2f630fdf3d1bd5cede6a65f283b880db6f3f6cd70d0a7e2bce09cb5a50f026d7cfa3621562c469d1623faa81639098ae362d937e8eb0b4e7f37c237698f803c616f83d0758bb3fb90cb8a29c758ca5de48b5fca33d0b166980b7fe6f70cf8094ddd21a296e20d27b178f43907996061116773e845e5ee951eb7be624097009d07454a44590bb5e5311bbbb59603e11c8d447846ff10fd0bcfc97e1696c909d2d10485b5281558ac4316616e65ce7088addbf335097e234b5c9aec9d3abbd905c2d198c6e2e110c75739f5576b138c150f58c5da04100fea0da1efacfbecfdd11b1fd900537a4138c93d45f8024e5c47458f73870eb2eb6332507a7dc3562cabe4b8feca3f52e6d699533fb7eb68d3162891b966f1b04f79120f8a0119ae9edcf24b7d7182fa66669914873eb1b3c75ceb3aefaae8900d9d8cae2b05cd6cc183a5723e28730bbfcda531ba88125fb8b501c665e78d70244cb538f3a2c2bab7c26b10964404a538f95c011719c2b582be7422b2ed3743c33c30fccf0a01f35d21564ff3528771392d43061298c6be664e43ee81292340f2459de9371afcaca9b58f5a72162c132e8208269c0a4c65208cec9394edfb4259ace05f728aa689fbd61c772f6c2f6409e6a03689e9fac6d3460ed6357db7b0d6204000f423d63040000000b9000

import crypto from 'crypto';

export const signRaw = async (
reader: any,
pin1: string = '000000',
pin2: string = '000'
) => {
const pin1Hex = crypto
.createHash('sha256')
.update(Buffer.from(pin1))
.digest('hex');

// 2AC9A6746ACA543AF8DFF39894CFE8173AFBA21EB01C6FAE33D52947222855EF
const pin2Hex = crypto
.createHash('sha256')
.update(Buffer.from(pin2))
.digest('hex');

// console.log(pin2Hex.toUpperCase());
const TAG_CardID = '0108' + 'BB03000000000004';
const TAG_PIN2 = '1120' + pin2Hex;
const TAG_TrOut_HashSize = '5101' + '40';
const TAG_TrOut_Hash =
'50FF0280' +
'B6CB700ED6E0EAF4B179B590349AFC8E96804164B5EFC36AF3EE8A35F4B863178E9A089BDD10453330A56BA77B7D83419DB048E294BE23373208EFF448E6C2DA222B2F64C285E66996769B5A03EF863CFD3B63DDB0727788291695E8FB84572E4BFE5A80674A41FD72EEB48592C9C79F44AE992C76ED1B0D55A670A83FC99EC6A8498EDC4CF1121623C409A8AAE3A16BB4441DE89F4CAA7BDE903B6C4057967E552B31C7EFB45ED96AA9144931A1DF3C7F53685F297A6FA019582C8B42C0D2856ADC595F08C28F75652C6C6F258E52152C39B1C56DE9CAFB1A38A096B80540C266292156A37AB134DA14F3B0F4BBA5433675BF39F947BB5418804830769896AEC6619FC744156858FD135D5CE392E96A1FF5384A11FD8977E35762ACB4224860A5A2F53D8DC4FA8FBCFF1AF990256617482CAFF472C6EF745FB0DB52D77411D0CF93DEC95DA6B9270337395EE4496BF217DF34C3A74D3F0B8624B90FC6EFF8669FFC88F647D40A7CB30D2035A72F7E44F412D9E463A49FB85931F2054C7D3F907FB9BA8168A7644E9FE589A65957C4A1E701B86F2ACB0602EE3A5CFA173628F4C3EC8BAD4F5A9639265345C0722A6161F581EB4E02992DA737EE0C6F93183DBBB4EB940D11A2635C5B25C7899C7D5E78818A4E289DA075F5DF61F7AC5E01FD81423CC19CEC4B2185290950EC7B7F6485BFEC606A5B8D017C02F48118B4FFE11C7AD277B4831CB44CF87BE9AB627C5CACCEECE9EDB06B5D7C3200099E54F1634578015445019E61A4EB895614059C97FF48F4004EA83DA985FB0F823D2143F55302516439EBDAF3C450734E326155DB8D6DD2E436373987B2EE717993C8C260F0C2FC14203CC2632B10EB90F73DDE1357FCDC47DC3107D2DE5C46A9BCD53FCED2';

// let parsed = await tlvToObject(Buffer.from(command, 'hex'));
// console.log('parsed command: ', parsed);
const packetString = [
'00', // CLA
'FB', // INS
'00', // P1
'00', // P2
'0002D5', // Lc
'10', // TAG
'20', // Length
pin1Hex, // Value,
TAG_CardID,
TAG_PIN2,
TAG_TrOut_HashSize,
TAG_TrOut_Hash,
]
.join('')
.toUpperCase();

const packet = Buffer.from(packetString, 'hex');
const response = await reader.transmit(packet, 8192);
return response;
};
